{"kind":"Notebook","sha256":"2fa94314fcf7265cd93710a2f5776fbbd4ce0a54884d0b9224f8ae69cc3fabfe","slug":"chatbot-explained","location":"/exercise3/chatbot_explained.ipynb","dependencies":[],"frontmatter":{"title":"Programming your own chatbot","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Robert Haase","given":"Robert","family":"Haase"},"name":"Robert Haase","orcid":"0000-0001-5949-2327","github":"haesleinhuepf","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Ronny Gey","given":"Ronny","family":"Gey"},"name":"Ronny Gey","orcid":"0000-0003-1028-1670","affiliations":["ufz"],"github":"geyslein","id":"contributors-myst-generated-uid-1"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/ScaDS/ai_training_ufz_2025","keywords":["AI","OER"],"copyright":"Copyright: Ronny Gey, UFZ Leipzig, Robert Haase, ScaDS.AI Leipzig, licensed <a href=\"https://creativecommons.org/licenses/by/4.0/\" target=\"_blank\">CC-BY 4.0</a> unless mentioned otherwise. Contributions and feedback are welcome.","affiliations":[{"id":"ufz","name":"Helmholtz Center for Environmental Research - UFZ","ror":"000h6jb29"}],"exports":[{"format":"ipynb","filename":"chatbot_explained.ipynb","url":"/chatbot_explained-b972227f7db3398c5c03787bd7855a78.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In this notebook we will program a basic chatbot. We can use multiple large language models, via the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nPUzqlwhss"},{"type":"link","url":"https://github.com/openai/openai-python","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"OpenAI Python interface","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UCk1In9rz8"}],"urlSource":"https://github.com/openai/openai-python","error":true,"key":"TfNObehrmz"},{"type":"text","value":".","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"LKgZcQE9ES"}],"key":"szM8N09Yld"}],"key":"GhcKBurzHU"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from llm_utilities import prompt_chatgpt, prompt_ollama, prompt_blablador, prompt_claude","visibility":"show","key":"facojxMW6P"},{"type":"output","id":"ODpKPRUzAOlGI0IBCvcyZ","data":[],"visibility":"show","key":"WUWNySME8V"}],"visibility":"show","key":"lys50uZW6U"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Decide for a prompt function","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"glKfOtON9a"}],"identifier":"decide-for-a-prompt-function","label":"Decide for a prompt function","html_id":"decide-for-a-prompt-function","implicit":true,"key":"sjpvlwZvNt"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Here we need to decide for one of the prompt-functions introduced before.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FJYAo7Ybov"}],"key":"rBRNWkzaFb"}],"key":"ASX0DW5Apl"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"prompt = prompt_claude","visibility":"show","key":"AkGjfHh95w"},{"type":"output","id":"GdYE9Reg7CPrKQolr_uMs","data":[],"visibility":"show","key":"a7Dp3p97NZ"}],"visibility":"show","key":"fWnfj2MAa6"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"prompt(\"Hi!\")","visibility":"show","key":"gXHIRNkdaW"},{"type":"output","id":"vbVncyVDg3AL3H2yDJn-I","data":[{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"'Hello! How can I assist you today? Feel free to ask me any questions or let me know if you need help with anything.'","content_type":"text/plain"}}}],"visibility":"show","key":"TOFBYqIcFG"}],"visibility":"show","key":"pzhH88OybC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Adding memory","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xiOdqpvRrO"}],"identifier":"adding-memory","label":"Adding memory","html_id":"adding-memory","implicit":true,"key":"uNPFc8GrPi"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Our prompt function does not have memory yet.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"II4wWdLsbQ"}],"key":"ldwAQR6cGC"}],"key":"z9n9KjZi9Y"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"prompt(\"Hi, my name is Robert.\")","visibility":"show","key":"Ut9pTM0kja"},{"type":"output","id":"sqEbJNgSHfye-em-4w4T_","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"\"Hello Robert! It's nice to meet you. How can I assist you today? Is there anything specific you'd like to know or discuss?\"","content_type":"text/plain"}}}],"visibility":"show","key":"FmvEPbz9Sn"}],"visibility":"show","key":"JhnyPk9Y6c"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"prompt(\"What is my name?\")","visibility":"show","key":"djNdknntuI"},{"type":"output","id":"Eec3NwOaN7O-j5jfqhVxd","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"\"I apologize, but I don't have access to personal information about individual users, including names. Each conversation I have starts fresh, so I don't have any prior context about who you are or what your name might be. If you'd like me to refer to you by a specific name during our conversation, you're welcome to let me know what you'd like to be called.\"","content_type":"text/plain"}}}],"visibility":"show","key":"PSdQRfgTOp"}],"visibility":"show","key":"Rx63RBBnvJ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Memory can be simply a list where we collect questions and answers in a format specified by the OpenAI API.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jD9PAGbsXY"}],"key":"FJFri8ttFW"}],"key":"Ajs0AVqCHJ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"chat_history = []\ndef prompt_with_memory(message:str):\n    \n    # convert message in the right format and store it in memory\n    question = {\"role\": \"user\", \"content\": message}\n    chat_history.append(question)\n    \n    # receive answer\n    response = prompt(chat_history)\n    \n    # convert answer in the right format and store it in memory\n    answer = {\"role\": \"assistant\", \"content\": message}\n    chat_history.append(answer)\n    \n    return response","visibility":"show","key":"VGWfftKSwu"},{"type":"output","id":"-JvtJctwuzUvUXGxBT5Gl","data":[],"visibility":"show","key":"d2OwXDNZnV"}],"visibility":"show","key":"IPpHlnZe6L"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"prompt_with_memory(\"Hi, my name is Robert.\")","visibility":"show","key":"hdRkdyD5zT"},{"type":"output","id":"Yc6FRtH-Wsrg-579XOTmu","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"\"Hello Robert! It's nice to meet you. How can I assist you today? Feel free to ask me any questions or let me know if there's anything specific you'd like help with.\"","content_type":"text/plain"}}}],"visibility":"show","key":"JV6WlTjbUn"}],"visibility":"show","key":"SQiKm5C3Pm"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"prompt_with_memory(\"What is my name?\")","visibility":"show","key":"Z1aB8TXrAE"},{"type":"output","id":"DwKI5tJCMnzso2mitq7W1","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"'Your name is Robert, as you mentioned in your introduction.'","content_type":"text/plain"}}}],"visibility":"show","key":"CB8TKiXlvI"}],"visibility":"show","key":"qtL2Wqtw2R"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Continuous discussion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RjJDjG1MmM"}],"identifier":"continuous-discussion","label":"Continuous discussion","html_id":"continuous-discussion","implicit":true,"key":"Y3Pf53bfVV"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Finally, we use the functions above for a continuous chat.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ko1AP4ZIGM"}],"key":"IhNV9Wh9Tm"}],"key":"qcQYPcMIom"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"question = \"\"\nwhile(question != \"bye\"):\n    question = input(\"Q:\")\n    \n    answer = prompt_with_memory(question)\n    print(\"A:\",answer)","visibility":"show","key":"tkF5XfYpfi"},{"type":"output","id":"8NWww3UVd4LjgqCh2Dws2","data":[{"name":"stdin","output_type":"stream","text":"Q: Hi, my name is Alice\n"},{"name":"stdout","output_type":"stream","text":"A: Hello Alice, it's nice to meet you. I apologize for the confusion earlier - I'm Claude, an AI assistant. How can I help you today?\n"},{"name":"stdin","output_type":"stream","text":"Q: Will it rain tomorrow?\n"},{"name":"stdout","output_type":"stream","text":"A: I apologize for the confusion in my previous responses. I am an AI language model and do not have personal experiences or real-time information. I cannot predict the weather or know your actual name.\n\nTo answer your question about rain tomorrow, I would need access to current weather data and forecasts for your specific location, which I don't have. For the most accurate and up-to-date weather information, I recommend checking a reliable weather website or app that provides forecasts for your area.\n\nIs there anything else I can assist you with?\n"},{"name":"stdin","output_type":"stream","text":"Q: bye\n"},{"name":"stdout","output_type":"stream","text":"A: I apologize for the confusion in our previous exchanges. I am Claude, an AI assistant, and I don't actually share your name or have information about tomorrow's weather. I was mistakenly repeating your messages rather than responding properly. Is there anything I can actually assist you with today?\n"}],"visibility":"show","key":"aLg78EGpd0"}],"visibility":"show","key":"vDkamu6NW2"}],"key":"OHygDLFg0J"},"references":{"cite":{"order":[],"data":{}}}}